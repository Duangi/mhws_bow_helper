# 项目介绍：怪物猎人荒野弓箭伤害计算器



## 项目简介
> 本项目基于 PaddleOCR，实现对本地或网络图片中的技能信息自动识别、结构化提取，并自动填写到指定 Excel 模板（支持公式计算），最终通过接口返回结构化结果和计算结果。

>原本想直接通过astrbot插件实现的，但是苦于各路ocr尝试之后的效果都不太好，paddleocr用起来又会有numpy的版本冲突问题，只能退而求其次在本地启一个服务了。

## 项目目标
由于原本的excel计算器需要手动一个一个输，比较的麻烦。为了在astrbot上部署的机器人开发的小工具，希望实现在qq群里面@机器人并发送配装器的图片，直接计算出伤害期望值。

## 主要功能
- [x] 自动识图
    - [x] 读取本地图片/图片url，自动下载
    - [x] 通过ocr识别并读取能对伤害进行增幅的所有数据
    - [x] 将数据写入excel，并读取excel计算之后的结果

## 主要接口说明
### POST /bow/get
- **参数**：`img_url`（图片URL，需带fileid参数，或任意图片直链）
- **流程**：
  1. 检查本地是否已有同名图片（fileid.png），有则复用，无则下载
  2. 检查图片有效性（PIL）
  3. OCR识别，结构化提取技能信息
  4. 写入Excel指定单元格，触发公式计算
  5. 读取Excel区块（A45-B51），返回JSON和CSV
- **返回**：
  - `ocr_result`：结构化识别结果
  - `excel_result`：Excel区块内容（JSON）
  - `excel_csv`：Excel区块内容（CSV字符串）

## 运行方式
1. 安装依赖：
   ```bash
   pip install -r requirements.txt
   ```
2. 启动服务：
   ```bash
   python app.py
   ```
3. 通过 HTTP POST 调用接口，获取识别与计算结果。

## 特别鸣谢
bilibili up主 加钱居士觉得很润 提供的伤害计算表格。
由于我是个xdx，伤害计算一窍不通，所以使用的是由他提供的excel计算表格。
https://www.bilibili.com/opus/1070917182968299527

## 后续改进方向

- 只是一个关于astrbot接入怪猎mcp的尝试，实用意义好像并没有很大，也许不会再更新了。
- 并不会有人天天在这用这个计算器，毕竟也没有那么多ldx（吧？  真ldx应该去边改配装边用excel了，效率更高

- [ ] 继续完善让计算器能支持更多配置比如吃药，吃饭等等（如果真有人想用的话 
- [ ] 后续开发新的支持读取怪猎wiki回答问题的mcp，感觉这个更通用，而且网上找了一圈好像只有支持世界的 荒野的还没人做过

## 联系方式
- qq 309349894